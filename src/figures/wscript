#!/usr/bin/env python

from shutil import copyfile


def build(ctx):
    """Runs necessary steps before everything else."""

    # Copies the matplotlibrc file to the build directory. This file can be
    # used to make persistent customization to figures.
    copyfile('src/figures/matplotlibrc', 'bld/matplotlibrc')

    for model_type in ['ten_comp', 'two_comp']:
        name = model_type.replace('_', '-')

        ctx(
            features='run_py_script',
            source='pca.py',
            deps=ctx.path_to(ctx, 'OUT_DATA', f'model_pca_{model_type}.pkl'),
            target=ctx.path_to(ctx, 'OUT_FIGURES',
                               f'fig-pca-{name}-explained-variance.png'),
            append=model_type,
            name=f'pca_{model_type}',
        )

    for model_type in ['ten_comp', 'two_comp']:
        name = model_type.replace('_', '-')

        ctx(
            features='run_py_script',
            source='fa.py',
            deps=ctx.path_to(ctx, 'OUT_DATA', f'model_fa_{model_type}.pkl'),
            target=ctx.path_to(ctx, 'OUT_FIGURES',
                               f'fig-fa-{name}-explained-variance.png'),
            append=model_type,
            name=f'fa_{model_type}',
        )
